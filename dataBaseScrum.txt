USE scrum;

-- Tabla ScrumTeam
CREATE TABLE ScrumTeam (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL, 
    description VARCHAR(255)	
);

-- Tabla Backlog
CREATE TABLE Backlog (
  id INT NOT NULL AUTO_INCREMENT,
  name VARCHAR(255) NOT NULL,
  description VARCHAR(255) NOT NULL,
  scrumTeamId INT NOT NULL,
  FOREIGN KEY (scrumTeamId) REFERENCES ScrumTeam (id),
  PRIMARY KEY (id)
);

-- Tabla Sprint
CREATE TABLE Sprint (
  id INT NOT NULL AUTO_INCREMENT,
  name VARCHAR(255) NOT NULL,
  description VARCHAR(255) NOT NULL,
  startDate DATE NOT NULL,
  endDate DATE NOT NULL,
  PRIMARY KEY (id),
  scrumTeamId INT NOT NULL,
  FOREIGN KEY (scrumTeamId) REFERENCES ScrumTeam (id)
);

-- Tabla Devs
CREATE TABLE Developer (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    phone VARCHAR(10) NOT NULL,
    rol ENUM('Developer', 'ScrumMaster', 'ProductOwner') NOT NULL,
    scrumTeamId INT NOT NULL,
    documentNumber VARCHAR(10) NOT NULL,
    password VARCHAR(255) NOT NULL,
    FOREIGN KEY (scrumTeamId) REFERENCES ScrumTeam (id)
);

-- Tabla Task
CREATE TABLE Task (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description VARCHAR(255) NOT NULL,
    priority INT NOT NULL,
    estimatedTime INT NOT NULL,
    status ENUM('pending', 'in_progress', 'completed') NOT NULL,
    backlogId INT,
    sprintId INT,
    developerId INT,
    scrumTeamId INT NOT NULL,
    FOREIGN KEY (scrumTeamId) REFERENCES ScrumTeam (id),
    FOREIGN KEY (backlogId) REFERENCES Backlog (id),
    FOREIGN KEY (sprintId) REFERENCES Sprint (id),
    FOREIGN KEY (developerId) REFERENCES Developer (id)
);

ALTER TABLE Task
ADD CONSTRAINT task_backlog_or_sprint_fk
CHECK (backlogId IS NOT NULL OR sprintId IS NOT NULL);